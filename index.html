<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jewelry Mobile Bill</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap');
        
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f3f4f6;
            -webkit-tap-highlight-color: transparent;
        }
        .luxury-font { font-family: 'Playfair Display', serif; }
        
        /* Mobile Keyboard Optimization */
        input[type="number"] { -moz-appearance: textfield; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        .form-card {
            background: white;
            border-radius: 1.25rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all 0.2s;
            background: #f9fafb;
        }

        .input-field:focus {
            outline: none;
            border-color: #b45309;
            background: white;
            box-shadow: 0 0 0 4px rgba(180, 83, 9, 0.1);
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .print-area { box-shadow: none !important; border: none !important; width: 100% !important; }
        }
    </style>
</head>
<body class="pb-10">

    <!-- Header -->
    <div class="bg-amber-900 text-white p-6 pb-10 rounded-b-[2.5rem] shadow-lg mb-[-2rem] no-print">
        <h1 class="luxury-font text-2xl text-center">Gleam & Gold</h1>
        <p class="text-amber-200 text-center text-xs uppercase tracking-widest opacity-80">Mobile Billing Portal</p>
    </div>

    <div class="max-w-md mx-auto px-4 no-print">
        <form id="billingForm" onsubmit="event.preventDefault(); generateBill();" class="space-y-4">
            
            <!-- Customer Section -->
            <div class="form-card p-5 mt-4">
                <h2 class="text-amber-900 font-bold mb-4 flex items-center">
                    <i class="fas fa-user-circle mr-2"></i> Customer Info
                </h2>
                <div class="space-y-3">
                    <input type="date" id="billDate" required class="input-field">
                    <input type="text" id="custName" placeholder="Customer Name" required class="input-field">
                    <div class="flex">
                        <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-100 text-gray-500 text-sm">+91</span>
                        <input type="tel" id="custContact" pattern="[0-9]{10}" inputmode="tel" placeholder="Mobile Number" required class="input-field rounded-l-none">
                    </div>
                </div>
            </div>

            <!-- Item Section -->
            <div class="form-card p-5">
                <h2 class="text-amber-900 font-bold mb-4 flex items-center">
                    <i class="fas fa-gem mr-2"></i> Purchase Details
                </h2>
                <div class="space-y-3">
                    <input type="text" id="itemName" placeholder="Item (e.g. Ring, Chain)" required class="input-field">
                    <select id="purity" class="input-field">
                        <option value="22K (91.6%)">22K (91.6%)</option>
                        <option value="24K (99.9%)">24K (99.9%)</option>
                        <option value="18K (75%)">18K (75%)</option>
                    </select>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] uppercase text-gray-400 font-bold ml-1">Weight (g)</label>
                            <input type="number" id="weight" step="0.001" inputmode="decimal" placeholder="0.000" required class="input-field">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase text-gray-400 font-bold ml-1">Rate (₹/g)</label>
                            <input type="number" id="rate" step="0.01" inputmode="decimal" placeholder="0.00" required class="input-field">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] uppercase text-gray-400 font-bold ml-1">Wastage (%)</label>
                            <input type="number" id="wastage" step="0.1" inputmode="decimal" value="0" class="input-field">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase text-gray-400 font-bold ml-1">Making (₹)</label>
                            <input type="number" id="making" step="1" inputmode="numeric" value="0" class="input-field">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="number" id="stone" inputmode="numeric" placeholder="Stone ₹" value="0" class="input-field">
                        <input type="number" id="hallmark" inputmode="numeric" placeholder="Hallmark ₹" value="0" class="input-field">
                    </div>
                    <input type="number" id="advance" inputmode="numeric" placeholder="Advance Paid ₹" value="0" class="input-field border-blue-200">
                </div>
            </div>

            <!-- Old Gold Section -->
            <div class="form-card p-5 bg-amber-50">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-amber-900 font-bold flex items-center">
                        <i class="fas fa-history mr-2"></i> Old Gold?
                    </h2>
                    <div class="flex bg-white rounded-lg p-1 shadow-sm border border-amber-200">
                        <button type="button" onclick="setOldGold(true)" id="ogYes" class="px-4 py-1 rounded-md text-sm transition">Yes</button>
                        <button type="button" onclick="setOldGold(false)" id="ogNo" class="px-4 py-1 rounded-md text-sm bg-amber-900 text-white transition">No</button>
                    </div>
                </div>
                <div id="oldGoldInputs" class="hidden space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <input type="number" id="oldW" step="0.001" inputmode="decimal" placeholder="Weight (g)" class="input-field bg-white">
                        <input type="number" id="oldR" step="0.01" inputmode="decimal" placeholder="Rate (₹)" class="input-field bg-white">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="number" id="oldP" step="1" inputmode="numeric" placeholder="Touch %" class="input-field bg-white">
                        <input type="number" id="oldWas" step="0.001" inputmode="decimal" placeholder="Wastage (g)" class="input-field bg-white">
                    </div>
                </div>
            </div>

            <button type="submit" class="w-full bg-amber-600 text-white py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-transform">
                <i class="fas fa-check-circle mr-2"></i> Generate Bill
            </button>
        </form>
    </div>

    <!-- Bill View -->
    <div id="billResult" class="hidden p-4 mt-6">
        <div id="printArea" class="bg-white rounded-2xl shadow-2xl p-6 border border-gray-200">
            <div class="text-center mb-6">
                <h1 class="luxury-font text-2xl text-amber-900">GLEAM & GOLD</h1>
                <p class="text-[10px] tracking-widest text-gray-400">AUTHENTIC JEWELRY INVOICE</p>
                <div class="h-0.5 w-12 bg-amber-600 mx-auto mt-2"></div>
            </div>

            <div class="flex justify-between text-[11px] mb-6 text-gray-600 leading-tight">
                <div>
                    <p class="font-bold text-gray-900" id="resName"></p>
                    <p id="resContact"></p>
                </div>
                <div class="text-right">
                    <p id="resDate"></p>
                    <p id="resInv">INV-9823</p>
                </div>
            </div>

            <table class="w-full text-xs mb-6">
                <tr class="border-b border-gray-100 text-gray-400">
                    <th class="text-left py-2 font-normal">Description</th>
                    <th class="text-right py-2 font-normal">Amount</th>
                </tr>
                <tr class="border-b border-gray-50">
                    <td class="py-3">
                        <p class="font-bold text-gray-800" id="resItem"></p>
                        <p class="text-[10px]" id="resSubDetails"></p>
                    </td>
                    <td class="text-right font-bold" id="resBase"></td>
                </tr>
                <tr class="text-gray-500">
                    <td class="pt-2">Wastage Charges (<span id="resWasPct"></span>%)</td>
                    <td class="text-right pt-2" id="resWasVal"></td>
                </tr>
                <tr class="text-gray-500">
                    <td>Making Charges</td>
                    <td class="text-right" id="resMakVal"></td>
                </tr>
                <tr class="text-gray-500 border-b border-gray-50">
                    <td class="pb-2">Stone & Hallmark</td>
                    <td class="text-right pb-2" id="resOtherVal"></td>
                </tr>
                <tr id="oldGoldRow" class="text-red-500 hidden bg-red-50">
                    <td class="py-2 px-1">Old Gold Exchange</td>
                    <td class="text-right py-2 px-1" id="resOldVal"></td>
                </tr>
                <tr class="text-blue-600">
                    <td class="py-2">Advance Received</td>
                    <td class="text-right py-2" id="resAdvVal"></td>
                </tr>
            </table>

            <div class="bg-amber-900 text-white p-4 rounded-xl flex justify-between items-center">
                <span class="text-sm">Payable Amount</span>
                <span class="text-xl font-bold" id="resGrand"></span>
            </div>

            <div class="mt-8 no-print space-y-3">
                <button onclick="downloadPDF()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">
                    <i class="fas fa-file-pdf mr-2"></i> Download PDF
                </button>
                <button onclick="shareWhatsApp()" class="w-full bg-green-500 text-white py-3 rounded-xl font-bold">
                    <i class="fab fa-whatsapp mr-2"></i> Share on WhatsApp
                </button>
                <button onclick="location.reload()" class="w-full text-gray-400 py-2 text-sm">Create New Bill</button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('billDate').valueAsDate = new Date();
        let useOldGold = false;

        function setOldGold(val) {
            useOldGold = val;
            const inputs = document.getElementById('oldGoldInputs');
            const yes = document.getElementById('ogYes');
            const no = document.getElementById('ogNo');
            
            if(val) {
                inputs.classList.remove('hidden');
                yes.className = "px-4 py-1 rounded-md text-sm bg-amber-900 text-white";
                no.className = "px-4 py-1 rounded-md text-sm text-amber-900 bg-white";
            } else {
                inputs.classList.add('hidden');
                no.className = "px-4 py-1 rounded-md text-sm bg-amber-900 text-white";
                yes.className = "px-4 py-1 rounded-md text-sm text-amber-900 bg-white";
            }
        }

        const fmt = (v) => "₹" + parseFloat(v || 0).toLocaleString('en-IN', { minimumFractionDigits: 2 });

        function generateBill() {
            // Inputs
            const w = parseFloat(document.getElementById('weight').value);
            const r = parseFloat(document.getElementById('rate').value);
            const wasP = parseFloat(document.getElementById('wastage').value);
            const mak = parseFloat(document.getElementById('making').value);
            const sto = parseFloat(document.getElementById('stone').value);
            const hal = parseFloat(document.getElementById('hallmark').value);
            const adv = parseFloat(document.getElementById('advance').value);

            // Calcs
            const base = w * r;
            const wastageInRs = base * (wasP / 100);
            const total = base + wastageInRs + mak + sto + hal;

            let oldDed = 0;
            if(useOldGold) {
                const ow = parseFloat(document.getElementById('oldW').value) || 0;
                const or = parseFloat(document.getElementById('oldR').value) || 0;
                const op = (parseFloat(document.getElementById('oldP').value) || 100) / 100;
                const owas = parseFloat(document.getElementById('oldWas').value) || 0;
                oldDed = (ow - owas) * or * op;
                document.getElementById('oldGoldRow').classList.remove('hidden');
            } else {
                document.getElementById('oldGoldRow').classList.add('hidden');
            }

            const final = total - oldDed - adv;

            // UI
            document.getElementById('resName').innerText = document.getElementById('custName').value;
            document.getElementById('resContact').innerText = "+91 " + document.getElementById('custContact').value;
            document.getElementById('resDate').innerText = document.getElementById('billDate').value;
            document.getElementById('resItem').innerText = document.getElementById('itemName').value;
            document.getElementById('resSubDetails').innerText = `${w}g @ ${r}/g | ${document.getElementById('purity').value}`;
            
            document.getElementById('resBase').innerText = fmt(base);
            document.getElementById('resWasPct').innerText = wasP;
            document.getElementById('resWasVal').innerText = fmt(wastageInRs);
            document.getElementById('resMakVal').innerText = fmt(mak);
            document.getElementById('resOtherVal').innerText = fmt(sto + hal);
            document.getElementById('resOldVal').innerText = "-" + fmt(oldDed);
            document.getElementById('resAdvVal').innerText = "-" + fmt(adv);
            document.getElementById('resGrand').innerText = fmt(Math.max(0, final));

            document.getElementById('billResult').classList.remove('hidden');
            document.getElementById('billResult').scrollIntoView({ behavior: 'smooth' });
        }

        function downloadPDF() {
            const element = document.getElementById('printArea');
            const opt = {
                margin: 5,
                filename: `Bill_${document.getElementById('custName').value}.pdf`,
                html2canvas: { scale: 3, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function shareWhatsApp() {
            const name = document.getElementById('custName').value;
            const total = document.getElementById('resGrand').innerText;
            const phone = "91" + document.getElementById('custContact').value;
            const msg = `*GLEAM & GOLD INVOICE*%0A%0AHi ${name},%0AYour bill for ${document.getElementById('itemName').value} is generated.%0A%0A*Total Amount:* ${total}%0A%0AThank you for shopping with us!`;
            window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>

